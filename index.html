<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CUBOX</title>
<style>
    html, body { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background: #87ceeb; }
    canvas { display: block; width: 100%; height: 100%; filter: blur(2px); }

    button {
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 40px;
        background-color: rgba(100,100,100,0.6);
        color: white;
        border: 2px solid white;
        border-radius: 6px;
        font-weight: bold;
        font-size: 14px;
        cursor: pointer;
        z-index: 1000;
        touch-action: manipulation;
        display: flex;
        justify-content: center;
        align-items: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        box-sizing: border-box;
    }

    #start-btn { top: 50%; transform: translate(-50%, -50%); }
    #play-btn { top: 50%; transform: translate(-50%, -50%); display: none; margin-bottom: 50px;}
    #settings-btn { top: 50%; transform: translate(-50%, -50%); display: none; margin-top: 60px; }

  #orientation-img {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: contain;  /* mantiene proporci√≥n y se adapta */
    display: none;
    z-index: 1000;
}

    #title {
        position: fixed;
        font-family: 'Press Start 2P', monospace;
        font-size: 40px;
        color: yellow;
        text-shadow: 2px 2px 0 red, -2px -2px 0 blue;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        z-index: 1000;
        pointer-events: none;
        text-align: center;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
<canvas id="game"></canvas>

<button id="start-btn">COMENZAR</button>
<button id="play-btn">JUGAR</button>
<button id="settings-btn">AJUSTES</button>
<img id="orientation-img" src="Texturas/horizontal.png">
<div id="title">CUBOX</div>

<script>
// ===== Mundo 2D de fondo =====
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const BLOCK_SIZE = 50;
const CHUNK_WIDTH = 10;
const grassImg = new Image(); grassImg.src = 'Texturas/cesped_parte_costado.jpg';
const dirtImg = new Image(); dirtImg.src = 'Texturas/tierra.jpg';
const stoneImg = new Image(); stoneImg.src = 'Texturas/piedra.jpg';

let chunks = {};
let cameraX = 0;
const camSpeed = 2;

function createChunk(chunkX){
    const column = [];
    for(let x=0; x<CHUNK_WIDTH; x++){
        const height = Math.floor(Math.random() * 3) + 3;
        const blocks = [];
        for(let y=0; y<height; y++){
            if(y === height-1) blocks.push('grass');
            else if(y >= height-3) blocks.push('dirt');
            else blocks.push('stone');
        }
        column.push(blocks);
    }
    chunks[chunkX] = column;
}

for(let i=0;i<5;i++) createChunk(i*CHUNK_WIDTH);

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const chunkKey in chunks){
        const chunk = chunks[chunkKey];
        const chunkX = parseInt(chunkKey);
        for(let x=0; x<chunk.length; x++){
            const blocks = chunk[x];
            for(let y=0; y<blocks.length; y++){
                let img;
                if(blocks[y]==='grass') img = grassImg;
                else if(blocks[y]==='dirt') img = dirtImg;
                else img = stoneImg;
                ctx.drawImage(img, (chunkX + x)*BLOCK_SIZE - cameraX, canvas.height - (y+1)*BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            }
        }
    }
}

function animate(){
    requestAnimationFrame(animate);
    cameraX += camSpeed;
    const lastChunkX = Math.max(...Object.keys(chunks));
    if(cameraX + canvas.width/ BLOCK_SIZE > lastChunkX){
        createChunk(lastChunkX + CHUNK_WIDTH);
    }
    for(const key in chunks){
        if((parseInt(key)+CHUNK_WIDTH)*BLOCK_SIZE - cameraX < -CHUNK_WIDTH*BLOCK_SIZE){
            delete chunks[key];
        }
    }
    draw();
}
animate();

// ===== UI y fullscreen =====
const startBtn = document.getElementById('start-btn');
const playBtn = document.getElementById('play-btn');
const settingsBtn = document.getElementById('settings-btn');
const title = document.getElementById('title');
const orientationImg = document.getElementById('orientation-img');

function updateUI(){
    const isFullscreen = !!document.fullscreenElement;
    const isHorizontal = window.innerWidth > window.innerHeight;

    if(isFullscreen && isHorizontal){
        startBtn.style.display = 'none';
        orientationImg.style.display = 'none';
        playBtn.style.display = 'block';
        settingsBtn.style.display = 'block';
        title.style.display = 'block';
    } else if(isFullscreen && !isHorizontal){
        startBtn.style.display = 'none';
        orientationImg.style.display = 'block';
        playBtn.style.display = 'none';
        settingsBtn.style.display = 'none';
        title.style.display = 'none';
    } else {
        startBtn.style.display = 'block';
        title.style.display = 'none';
        playBtn.style.display = 'none';
        settingsBtn.style.display = 'none';
        orientationImg.style.display = 'none';
    }
}

startBtn.addEventListener('click', ()=>{
    if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
    updateUI();
});

playBtn.addEventListener('click', ()=>{
    // Ir a game.html sin salir del fullscreen
    fetch('game.html').then(r => r.text()).then(html=>{
        document.open();
        document.write(html);
        document.close();
        if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
    });
});

window.addEventListener('resize', updateUI);
document.addEventListener('fullscreenchange', updateUI);
</script>
</body>
</html>
